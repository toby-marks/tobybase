<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Toby Marks">
    <meta name="description" content="My tech blog">
    <meta name="keywords" content="oracle,infolob,blog,consultant,developer,tuning,exadata,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Use DML Error Logging"/>
<meta name="twitter:description" content="Introduced with Oracle 10gR2, DML Error Logging allows you to make standard SQL INSERT, UPDATE, and MERGE statements behave more like the SQL*Loader utility, logging errors to a table rather than failing and rolling back the first time an error condition is encountered.
The syntax is the same for all DML statements. Just add the following clause to the end of your DML:
LOG ERRORS The database will automatically create an error log table for you."/>

    <meta property="og:title" content="Use DML Error Logging" />
<meta property="og:description" content="Introduced with Oracle 10gR2, DML Error Logging allows you to make standard SQL INSERT, UPDATE, and MERGE statements behave more like the SQL*Loader utility, logging errors to a table rather than failing and rolling back the first time an error condition is encountered.
The syntax is the same for all DML statements. Just add the following clause to the end of your DML:
LOG ERRORS The database will automatically create an error log table for you." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://tobybase.com/posts/2012-06-07-dml-error-logging/" />
<meta property="article:published_time" content="2012-06-07T17:04:00+00:00" />
<meta property="article:modified_time" content="2017-02-22T00:00:00+00:00" />


    
      <base href="http://tobybase.com/posts/2012-06-07-dml-error-logging/">
    
    <title>
  Use DML Error Logging ¬∑ üë®üèª‚Äçüíª Tobybase
</title>

    
      <link rel="canonical" href="http://tobybase.com/posts/2012-06-07-dml-error-logging/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="http://tobybase.com/css/coder.min.28d751104f30c16da1aa1bb04015cbe662cacfe0d1b01af4f2240ad58580069c.css" integrity="sha256-KNdREE8wwW2hqhuwQBXL5mLKz&#43;DRsBr08iQK1YWABpw=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="http://tobybase.com/css/custom.css">
    

    <link rel="icon" type="image/png" href="http://tobybase.com/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://tobybase.com/img/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.64.1" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="http://tobybase.com">
      üë®üèª‚Äçüíª Tobybase
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://tobybase.com/posts/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://tobybase.com/links/">Links</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://tobybase.com/about/">About</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Use DML Error Logging</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2012-06-07T17:04:00Z'>
                June 7, 2012
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              3 minutes read
            </span>
          </div>
          <div class="categories">
  <i class="fas fa-folder"></i>
    <a href="http://tobybase.com/categories/database/">Database</a></div>

          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="http://tobybase.com/tags/oracle/">oracle</a>
      <span class="separator">‚Ä¢</span>
    <a href="http://tobybase.com/tags/sql/">sql</a>
      <span class="separator">‚Ä¢</span>
    <a href="http://tobybase.com/tags/sqlloader/">sqlloader</a></div>

        </div>
      </header>

      <div>
        <p>Introduced with Oracle 10gR2, DML Error Logging allows you to make standard SQL <code>INSERT</code>, <code>UPDATE</code>, and <code>MERGE</code> statements behave more like the SQL*Loader utility, logging errors to a table rather than failing and rolling back the first time an error condition is encountered.</p>
<p>The syntax is the same for all DML statements. Just add the following clause to the end of your DML:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">    LOG ERRORS 
</code></pre></div><p>The database will automatically create an error log table for you. Per the documentation (<a href="http://docs.oracle.com/cd/B28359%5F01/server.111/b28286/statements%5F9014.htm">11g</a>, <a href="http://docs.oracle.com/cd/E11882_01/server.112/e25494/tables004.htm#InsertDMLErrorLogging">11gR2</a>):</p>
<blockquote>
<p>‚Ä¶ the database assigns the default name generated by the DBMS_ERRLOG package. The default error log table name is ERR$_ followed by the first 25 characters of the name of the table upon which the DML operation is being executed.</p>
</blockquote>
<p>In most cases you&rsquo;ll probably want to specify your own log table, like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">    LOG ERRORS <span style="font-weight:bold">INTO</span> error_table
</code></pre></div><p>If you do, you&rsquo;ll need to create the table beforehand with <code>DBMS_ERRLOG</code>.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">    <span style="font-weight:bold">EXEC</span> DBMS_ERRLOG.CREATE_ERROR_LOG(<span style="font-style:italic">&#39;</span><span style="font-style:italic">table</span><span style="font-style:italic">&#39;</span>, <span style="font-style:italic">&#39;</span><span style="font-style:italic">error_table</span><span style="font-style:italic">&#39;</span>);
</code></pre></div><p>Like SQL*Loader, you can specify a maximum number of errors to tolerate before failing and rolling back the transaction. You can also just say <code>UNLIMITED</code> if you don&rsquo;t ever want to fail the transaction.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">    LOG ERRORS <span style="font-weight:bold">INTO</span> error_table REJECT <span style="font-weight:bold">LIMIT</span> 99
    LOG ERRORS <span style="font-weight:bold">INTO</span> error_table REJECT <span style="font-weight:bold">LIMIT</span> UNLIMITED
</code></pre></div><p>Since the default limit is zero, it makes sense to always include this clause.</p>
<p>The last option is to specify a string that identifies that particular DML operation, so that you can group sets of errors in the log table. Here is an example that incorporates <code>SYSDATE</code> to tag all errors belonging to this DML operation.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">    LOG ERRORS <span style="font-weight:bold">INTO</span> error_table (<span style="font-style:italic">&#39;</span><span style="font-style:italic">Import from external datasource </span><span style="font-style:italic">&#39;</span>||TO_CHAR(SYSDATE)) REJECT <span style="font-weight:bold">LIMIT</span> UNLIMITED
</code></pre></div><p>Putting it all together, here is a short example demonstrating the use of DML Error Logging for merging data between two similar, but non-identically structured tables. An alternate strategy might have involved creating a custom interface table with a block of PL/SQL to perform inserts and mark the failed rows. Here, we take advantage of the native capabilities of the database to simplify and accelerate the process.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">    <span style="font-weight:bold">create</span> <span style="font-weight:bold">table</span> users_loc (id number <span style="font-weight:bold">primary</span> <span style="font-weight:bold">key</span>, name varchar2(75));
    
    <span style="font-weight:bold">create</span> <span style="font-weight:bold">table</span> users_ext (uuid varchar2(10), fname varchar2(15), lname varchar2(20));
    <span style="font-weight:bold">insert</span> <span style="font-weight:bold">into</span> users_ext <span style="font-weight:bold">values</span>(<span style="font-style:italic">&#39;</span><span style="font-style:italic">1000</span><span style="font-style:italic">&#39;</span>, <span style="font-style:italic">&#39;</span><span style="font-style:italic">Scotty</span><span style="font-style:italic">&#39;</span>,  <span style="font-style:italic">&#39;</span><span style="font-style:italic">P</span><span style="font-style:italic">&#39;</span>);
    <span style="font-weight:bold">insert</span> <span style="font-weight:bold">into</span> users_ext <span style="font-weight:bold">values</span>(<span style="font-style:italic">&#39;</span><span style="font-style:italic">2000</span><span style="font-style:italic">&#39;</span>, <span style="font-style:italic">&#39;</span><span style="font-style:italic">Melinda</span><span style="font-style:italic">&#39;</span>, <span style="font-style:italic">&#39;</span><span style="font-style:italic">Manning</span><span style="font-style:italic">&#39;</span>);
    <span style="font-weight:bold">insert</span> <span style="font-weight:bold">into</span> users_ext <span style="font-weight:bold">values</span>(<span style="font-style:italic">&#39;</span><span style="font-style:italic">200J</span><span style="font-style:italic">&#39;</span>, <span style="font-style:italic">&#39;</span><span style="font-style:italic">Jamie</span><span style="font-style:italic">&#39;</span>,   <span style="font-style:italic">&#39;</span><span style="font-style:italic">Brooks</span><span style="font-style:italic">&#39;</span>);
    <span style="font-weight:bold">insert</span> <span style="font-weight:bold">into</span> users_ext <span style="font-weight:bold">values</span>(<span style="font-style:italic">&#39;</span><span style="font-style:italic">1000</span><span style="font-style:italic">&#39;</span>, <span style="font-style:italic">&#39;</span><span style="font-style:italic">Jason</span><span style="font-style:italic">&#39;</span>,   <span style="font-style:italic">&#39;</span><span style="font-style:italic">Jennings</span><span style="font-style:italic">&#39;</span>);
    <span style="font-weight:bold">insert</span> <span style="font-weight:bold">into</span> users_ext <span style="font-weight:bold">values</span>(<span style="font-style:italic">&#39;</span><span style="font-style:italic">4000</span><span style="font-style:italic">&#39;</span>, <span style="font-style:italic">&#39;</span><span style="font-style:italic">Marcus</span><span style="font-style:italic">&#39;</span>,  <span style="font-style:italic">&#39;</span><span style="font-style:italic">Nevada</span><span style="font-style:italic">&#39;</span>);
    <span style="font-weight:bold">insert</span> <span style="font-weight:bold">into</span> users_ext <span style="font-weight:bold">values</span>(<span style="font-style:italic">&#39;</span><span style="font-style:italic">AAAA</span><span style="font-style:italic">&#39;</span>, <span style="font-style:italic">&#39;</span><span style="font-style:italic">Alfred</span><span style="font-style:italic">&#39;</span>,  <span style="font-style:italic">&#39;</span><span style="font-style:italic">Butler</span><span style="font-style:italic">&#39;</span>);
    <span style="font-weight:bold">insert</span> <span style="font-weight:bold">into</span> users_ext <span style="font-weight:bold">values</span>(<span style="font-style:italic">&#39;</span><span style="font-style:italic">ABAB</span><span style="font-style:italic">&#39;</span>, <span style="font-style:italic">&#39;</span><span style="font-style:italic">Simon</span><span style="font-style:italic">&#39;</span>,   <span style="font-style:italic">&#39;</span><span style="font-style:italic">Jones</span><span style="font-style:italic">&#39;</span>);
    <span style="font-weight:bold">insert</span> <span style="font-weight:bold">into</span> users_ext <span style="font-weight:bold">values</span>(<span style="font-style:italic">&#39;</span><span style="font-style:italic">6000</span><span style="font-style:italic">&#39;</span>, <span style="font-style:italic">&#39;</span><span style="font-style:italic">Joon</span><span style="font-style:italic">&#39;</span>,    <span style="font-style:italic">&#39;</span><span style="font-style:italic">Patel</span><span style="font-style:italic">&#39;</span>);
    <span style="font-weight:bold">insert</span> <span style="font-weight:bold">into</span> users_ext <span style="font-weight:bold">values</span>(<span style="font-style:italic">&#39;</span><span style="font-style:italic">7000</span><span style="font-style:italic">&#39;</span>, <span style="font-style:italic">&#39;</span><span style="font-style:italic">Wanda</span><span style="font-style:italic">&#39;</span>,   <span style="font-style:italic">&#39;</span><span style="font-style:italic">Lutz</span><span style="font-style:italic">&#39;</span>);
    <span style="font-weight:bold">insert</span> <span style="font-weight:bold">into</span> users_ext <span style="font-weight:bold">values</span>(<span style="font-style:italic">&#39;</span><span style="font-style:italic">8000</span><span style="font-style:italic">&#39;</span>, <span style="font-style:italic">&#39;</span><span style="font-style:italic">Joseph</span><span style="font-style:italic">&#39;</span>,  <span style="font-style:italic">&#39;</span><span style="font-style:italic">McBride</span><span style="font-style:italic">&#39;</span>);
    
    <span style="font-weight:bold">exec</span> dbms_errlog.create_error_log(<span style="font-style:italic">&#39;</span><span style="font-style:italic">users_loc</span><span style="font-style:italic">&#39;</span>,<span style="font-style:italic">&#39;</span><span style="font-style:italic">users_errs</span><span style="font-style:italic">&#39;</span>);
    
    <span style="font-weight:bold">insert</span> <span style="font-weight:bold">into</span> users_loc (id, name) 
    <span style="font-weight:bold">select</span> uuid, 
           fname||<span style="font-style:italic">&#39;</span><span style="font-style:italic"> </span><span style="font-style:italic">&#39;</span>||lname 
      <span style="font-weight:bold">from</span> users_ext 
    log errors <span style="font-weight:bold">into</span> users_errs (<span style="font-style:italic">&#39;</span><span style="font-style:italic">import from users_ext: </span><span style="font-style:italic">&#39;</span>||to_char(sysdate)) 
    reject <span style="font-weight:bold">limit</span> unlimited;
    
    col ora_err_mesg$ format a40
    col ora_err_rowid$ format a15
    col ora_err_tag$ format a50
    col id format a10
    col name format a30
    <span style="font-weight:bold">select</span> * <span style="font-weight:bold">from</span> users_errs;
    
    ORA_ERR_NUMBER$ ORA_ERR_MESG$                            ORA_ERR_ROWID$  ORA_ERR_OPTYP$ ORA_ERR_TAG$                                       ID         NAME                         
    <span style="font-style:italic">--------------- ---------------------------------------- --------------- -------------- -------------------------------------------------- ---------- ------------------------------
</span><span style="font-style:italic"></span>               1722 ORA-01722: invalid number                                I              import <span style="font-weight:bold">from</span> users_ext: 07-JUN-2012 12:00:09        200J       Jamie Brooks                   
                                                                                                                                                                                         
    
                  1 ORA-00001: <span style="font-weight:bold">unique</span> <span style="font-weight:bold">constraint</span> (NUCDBA.SYS                 I              import <span style="font-weight:bold">from</span> users_ext: 07-JUN-2012 12:00:09        1000       Jason Jennings                 
                    _C00128181) violated                                                                                                                                                 
                                                                                                                                                                                         
    
               1722 ORA-01722: invalid number                                I              import <span style="font-weight:bold">from</span> users_ext: 07-JUN-2012 12:00:09        AAAA       Alfred Butler                  
                                                                                                                                                                                         
    
               1722 ORA-01722: invalid number                                I              import <span style="font-weight:bold">from</span> users_ext: 07-JUN-2012 12:00:09        ABAB       Simon Jones                    
</code></pre></div>
      </div>

      <footer>
        


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "tobybase-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
      <p>Oracle Database Developer and Performance Tuner, specialized on the Exadata platform. Working for Infolob from Irving, Texas. #OCICertified </p>
    
     ¬© 2020
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
