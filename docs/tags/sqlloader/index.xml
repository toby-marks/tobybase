<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Sqlloader on Tobybase: A Tech Blog</title>
    <link>http://localhost:1313/tags/sqlloader/</link>
    <description>Recent content in Sqlloader on Tobybase: A Tech Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-US</language>
    <copyright>2017 ~ Toby Marks</copyright>
    <lastBuildDate>Thu, 07 Jun 2012 17:04:00 +0000</lastBuildDate>
    <atom:link href="/tags/sqlloader/" rel="self" type="application/rss+xml" />
    
      
        
          <item>
            <title>Use DML Error Logging</title>
            <link>http://localhost:1313/blog/2012/06/07/use-dml-error-logging/</link>
            <pubDate>Thu, 07 Jun 2012 17:04:00 +0000</pubDate>
            
            <guid>http://localhost:1313/blog/2012/06/07/use-dml-error-logging/</guid>
            <description>&lt;p&gt;Introduced with Oracle 10gR2, DML Error Logging allows you to make standard SQL &lt;code&gt;INSERT&lt;/code&gt;, &lt;code&gt;UPDATE&lt;/code&gt;, and &lt;code&gt;MERGE&lt;/code&gt; statements behave more like the SQL*Loader utility, logging errors to a table rather than failing and rolling back the first time an error condition is encountered.&lt;/p&gt;

&lt;p&gt;The syntax is the same for all DML statements. Just add the following clause to the end of your DML:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;    LOG ERRORS &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The database will automatically create an error log table for you. Per the documentation (&lt;a href=&#34;http://docs.oracle.com/cd/B28359%5F01/server.111/b28286/statements%5F9014.htm&#34;&gt;11g&lt;/a&gt;, &lt;a href=&#34;http://docs.oracle.com/cd/E11882_01/server.112/e25494/tables004.htm#InsertDMLErrorLogging&#34;&gt;11gR2&lt;/a&gt;):
&amp;gt; â€¦ the database assigns the default name generated by the DBMS&lt;em&gt;ERRLOG package. The default error log table name is ERR$&lt;/em&gt; followed by the first 25 characters of the name of the table upon which the DML operation is being executed.&lt;/p&gt;

&lt;p&gt;In most cases you&amp;rsquo;ll probably want to specify your own log table, like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;    LOG ERRORS &lt;span style=&#34;color:#00a&#34;&gt;INTO&lt;/span&gt; error_table&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you do, you&amp;rsquo;ll need to create the table beforehand with &lt;code&gt;DBMS_ERRLOG&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;    &lt;span style=&#34;color:#00a&#34;&gt;EXEC&lt;/span&gt; DBMS_ERRLOG.CREATE_ERROR_LOG(&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;table&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;error_table&amp;#39;&lt;/span&gt;);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Like SQL*Loader, you can specify a maximum number of errors to tolerate before failing and rolling back the transaction. You can also just say &lt;code&gt;UNLIMITED&lt;/code&gt; if you don&amp;rsquo;t ever want to fail the transaction.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;    LOG ERRORS &lt;span style=&#34;color:#00a&#34;&gt;INTO&lt;/span&gt; error_table REJECT &lt;span style=&#34;color:#00a&#34;&gt;LIMIT&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;99&lt;/span&gt;
    LOG ERRORS &lt;span style=&#34;color:#00a&#34;&gt;INTO&lt;/span&gt; error_table REJECT &lt;span style=&#34;color:#00a&#34;&gt;LIMIT&lt;/span&gt; UNLIMITED&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Since the default limit is zero, it makes sense to always include this clause.&lt;/p&gt;

&lt;p&gt;The last option is to specify a string that identifies that particular DML operation, so that you can group sets of errors in the log table. Here is an example that incorporates &lt;code&gt;SYSDATE&lt;/code&gt; to tag all errors belonging to this DML operation.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;    LOG ERRORS &lt;span style=&#34;color:#00a&#34;&gt;INTO&lt;/span&gt; error_table (&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Import from external datasource &amp;#39;&lt;/span&gt;||TO_CHAR(SYSDATE)) REJECT &lt;span style=&#34;color:#00a&#34;&gt;LIMIT&lt;/span&gt; UNLIMITED&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Putting it all together, here is a short example demonstrating the use of DML Error Logging for merging data between two similar, but non-identically structured tables. An alternate strategy might have involved creating a custom interface table with a block of PL/SQL to perform inserts and mark the failed rows. Here, we take advantage of the native capabilities of the database to simplify and accelerate the process.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;    &lt;span style=&#34;color:#00a&#34;&gt;create&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;table&lt;/span&gt; users_loc (id &lt;span style=&#34;color:#0aa&#34;&gt;number&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;primary&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;key&lt;/span&gt;, name varchar2(&lt;span style=&#34;color:#099&#34;&gt;75&lt;/span&gt;));
    
    &lt;span style=&#34;color:#00a&#34;&gt;create&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;table&lt;/span&gt; users_ext (uuid varchar2(&lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;), fname varchar2(&lt;span style=&#34;color:#099&#34;&gt;15&lt;/span&gt;), lname varchar2(&lt;span style=&#34;color:#099&#34;&gt;20&lt;/span&gt;));
    &lt;span style=&#34;color:#00a&#34;&gt;insert&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;into&lt;/span&gt; users_ext &lt;span style=&#34;color:#00a&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;1000&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Scotty&amp;#39;&lt;/span&gt;,  &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;P&amp;#39;&lt;/span&gt;);
    &lt;span style=&#34;color:#00a&#34;&gt;insert&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;into&lt;/span&gt; users_ext &lt;span style=&#34;color:#00a&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;2000&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Melinda&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Manning&amp;#39;&lt;/span&gt;);
    &lt;span style=&#34;color:#00a&#34;&gt;insert&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;into&lt;/span&gt; users_ext &lt;span style=&#34;color:#00a&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;200J&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Jamie&amp;#39;&lt;/span&gt;,   &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Brooks&amp;#39;&lt;/span&gt;);
    &lt;span style=&#34;color:#00a&#34;&gt;insert&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;into&lt;/span&gt; users_ext &lt;span style=&#34;color:#00a&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;1000&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Jason&amp;#39;&lt;/span&gt;,   &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Jennings&amp;#39;&lt;/span&gt;);
    &lt;span style=&#34;color:#00a&#34;&gt;insert&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;into&lt;/span&gt; users_ext &lt;span style=&#34;color:#00a&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;4000&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Marcus&amp;#39;&lt;/span&gt;,  &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Nevada&amp;#39;&lt;/span&gt;);
    &lt;span style=&#34;color:#00a&#34;&gt;insert&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;into&lt;/span&gt; users_ext &lt;span style=&#34;color:#00a&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;AAAA&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Alfred&amp;#39;&lt;/span&gt;,  &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Butler&amp;#39;&lt;/span&gt;);
    &lt;span style=&#34;color:#00a&#34;&gt;insert&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;into&lt;/span&gt; users_ext &lt;span style=&#34;color:#00a&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;ABAB&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Simon&amp;#39;&lt;/span&gt;,   &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Jones&amp;#39;&lt;/span&gt;);
    &lt;span style=&#34;color:#00a&#34;&gt;insert&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;into&lt;/span&gt; users_ext &lt;span style=&#34;color:#00a&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;6000&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Joon&amp;#39;&lt;/span&gt;,    &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Patel&amp;#39;&lt;/span&gt;);
    &lt;span style=&#34;color:#00a&#34;&gt;insert&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;into&lt;/span&gt; users_ext &lt;span style=&#34;color:#00a&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;7000&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Wanda&amp;#39;&lt;/span&gt;,   &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Lutz&amp;#39;&lt;/span&gt;);
    &lt;span style=&#34;color:#00a&#34;&gt;insert&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;into&lt;/span&gt; users_ext &lt;span style=&#34;color:#00a&#34;&gt;values&lt;/span&gt;(&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;8000&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Joseph&amp;#39;&lt;/span&gt;,  &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;McBride&amp;#39;&lt;/span&gt;);
    
    &lt;span style=&#34;color:#00a&#34;&gt;exec&lt;/span&gt; dbms_errlog.create_error_log(&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;users_loc&amp;#39;&lt;/span&gt;,&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;users_errs&amp;#39;&lt;/span&gt;);
    
    &lt;span style=&#34;color:#00a&#34;&gt;insert&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;into&lt;/span&gt; users_loc (id, name) 
    &lt;span style=&#34;color:#00a&#34;&gt;select&lt;/span&gt; uuid, 
           fname||&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;||lname 
      &lt;span style=&#34;color:#00a&#34;&gt;from&lt;/span&gt; users_ext 
    log errors &lt;span style=&#34;color:#00a&#34;&gt;into&lt;/span&gt; users_errs (&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;import from users_ext: &amp;#39;&lt;/span&gt;||to_char(sysdate)) 
    reject &lt;span style=&#34;color:#00a&#34;&gt;limit&lt;/span&gt; unlimited;
    
    col ora_err_mesg$ format a40
    col ora_err_rowid$ format a15
    col ora_err_tag$ format a50
    col id format a10
    col name format a30
    &lt;span style=&#34;color:#00a&#34;&gt;select&lt;/span&gt; * &lt;span style=&#34;color:#00a&#34;&gt;from&lt;/span&gt; users_errs;
    
    ORA_ERR_NUMBER$ ORA_ERR_MESG$                            ORA_ERR_ROWID$  ORA_ERR_OPTYP$ ORA_ERR_TAG$                                       ID         NAME                         
    &lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;--------------- ---------------------------------------- --------------- -------------- -------------------------------------------------- ---------- ------------------------------
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;               &lt;span style=&#34;color:#099&#34;&gt;1722&lt;/span&gt; ORA-&lt;span style=&#34;color:#099&#34;&gt;01722&lt;/span&gt;: invalid &lt;span style=&#34;color:#0aa&#34;&gt;number&lt;/span&gt;                                I              import &lt;span style=&#34;color:#00a&#34;&gt;from&lt;/span&gt; users_ext: &lt;span style=&#34;color:#099&#34;&gt;07&lt;/span&gt;-JUN-&lt;span style=&#34;color:#099&#34;&gt;2012&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;:&lt;span style=&#34;color:#099&#34;&gt;00&lt;/span&gt;:&lt;span style=&#34;color:#099&#34;&gt;09&lt;/span&gt;        &lt;span style=&#34;color:#099&#34;&gt;200&lt;/span&gt;J       Jamie Brooks                   
                                                                                                                                                                                         
    
                  &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt; ORA-&lt;span style=&#34;color:#099&#34;&gt;00001&lt;/span&gt;: &lt;span style=&#34;color:#00a&#34;&gt;unique&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;constraint&lt;/span&gt; (NUCDBA.SYS                 I              import &lt;span style=&#34;color:#00a&#34;&gt;from&lt;/span&gt; users_ext: &lt;span style=&#34;color:#099&#34;&gt;07&lt;/span&gt;-JUN-&lt;span style=&#34;color:#099&#34;&gt;2012&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;:&lt;span style=&#34;color:#099&#34;&gt;00&lt;/span&gt;:&lt;span style=&#34;color:#099&#34;&gt;09&lt;/span&gt;        &lt;span style=&#34;color:#099&#34;&gt;1000&lt;/span&gt;       Jason Jennings                 
                    _C00128181) violated                                                                                                                                                 
                                                                                                                                                                                         
    
               &lt;span style=&#34;color:#099&#34;&gt;1722&lt;/span&gt; ORA-&lt;span style=&#34;color:#099&#34;&gt;01722&lt;/span&gt;: invalid &lt;span style=&#34;color:#0aa&#34;&gt;number&lt;/span&gt;                                I              import &lt;span style=&#34;color:#00a&#34;&gt;from&lt;/span&gt; users_ext: &lt;span style=&#34;color:#099&#34;&gt;07&lt;/span&gt;-JUN-&lt;span style=&#34;color:#099&#34;&gt;2012&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;:&lt;span style=&#34;color:#099&#34;&gt;00&lt;/span&gt;:&lt;span style=&#34;color:#099&#34;&gt;09&lt;/span&gt;        AAAA       Alfred Butler                  
                                                                                                                                                                                         
    
               &lt;span style=&#34;color:#099&#34;&gt;1722&lt;/span&gt; ORA-&lt;span style=&#34;color:#099&#34;&gt;01722&lt;/span&gt;: invalid &lt;span style=&#34;color:#0aa&#34;&gt;number&lt;/span&gt;                                I              import &lt;span style=&#34;color:#00a&#34;&gt;from&lt;/span&gt; users_ext: &lt;span style=&#34;color:#099&#34;&gt;07&lt;/span&gt;-JUN-&lt;span style=&#34;color:#099&#34;&gt;2012&lt;/span&gt; &lt;span style=&#34;color:#099&#34;&gt;12&lt;/span&gt;:&lt;span style=&#34;color:#099&#34;&gt;00&lt;/span&gt;:&lt;span style=&#34;color:#099&#34;&gt;09&lt;/span&gt;        ABAB       Simon Jones                    &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
          </item>
        
      
    
  </channel>
</rss>
