<!DOCTYPE html>
<html class="no-js" lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="description" content="Use DML Error Logging">
    <meta name="author" content="Toby Marks">

    <meta name="keyword" content="">
    <link rel="shortcut icon" href="/favicon.ico">

    <title>Use DML Error Logging &middot; tobybase</title>

   	
    
        <link rel="stylesheet" href="http://www.tobybase.com//css/theme/cosmo.css">
    

    <link rel="stylesheet" href="http://www.tobybase.com//css/font-awesome.min.css">

   	
   	<link rel="stylesheet" href="http://www.tobybase.com//css/style.css">

    
    <link href="" rel="alternate" type="application/rss+xml" title="tobybase" />
</head>
<body lang="en-US">
    
    <div class="container">
    <div class="row">
        <div class="navbar navbar-default " role="navigation">
            <div class="navbar-header">
                <a class="navbar-brand" href="http://www.tobybase.com/"><img src="http://www.tobybase.com/img/logo.png" height="100%"></a>
            </div>
            <div class="navbar-collapse collapse navbar-responsive-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://www.tobybase.com/">Home</a></li>
                    <li><a href="http://www.tobybase.com//post/">Blog</a></li>
                    
                </ul>
            </div>
        </div>
    </div>
</div>



<div class="container">
	<div class="row">
		<div class="col-md-offset-1 col-md-10">
			<h3>Use DML Error Logging</h3>
				<span class="label label-primary">06/07/2012</span> in 
				
					
					<a href="/categories/splaining">Splaining</a>
				 using tags
				
					
					<a href="/tags/oracle">oracle</a>
				
					 , 
					<a href="/tags/sql">sql</a>
				
					 , 
					<a href="/tags/sqlloader">sqlloader</a>
				
			</small>
		</div>
	</div>
	<div class="row">
		<div class="col-md-offset-1 col-md-10">
			<br>
			<p>Introduced with Oracle 10gR2, DML Error Logging allows you to make standard SQL <code>INSERT</code>, <code>UPDATE</code>, and <code>MERGE</code> statements behave more like the SQL*Loader utility, logging errors to a table rather than failing and rolling back the first time an error condition is encountered.</p>

<p>The syntax is the same for all DML statements. Just add the following clause to the end of your DML:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>    LOG ERRORS 
</pre></div>

<p>The database will automatically create an error log table for you. Per the documentation (<a href="http://docs.oracle.com/cd/B28359%5F01/server.111/b28286/statements%5F9014.htm">11g</a>, <a href="http://docs.oracle.com/cd/E11882_01/server.112/e25494/tables004.htm#InsertDMLErrorLogging">11gR2</a>):
&gt; â€¦ the database assigns the default name generated by the DBMS<em>ERRLOG package. The default error log table name is ERR$</em> followed by the first 25 characters of the name of the table upon which the DML operation is being executed.</p>

<p>In most cases you&rsquo;ll probably want to specify your own log table, like this:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>    LOG ERRORS <span style="color: #0000aa">INTO</span> error_table
</pre></div>

<p>If you do, you&rsquo;ll need to create the table beforehand with <code>DBMS_ERRLOG</code>.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>    <span style="color: #0000aa">EXEC</span> DBMS_ERRLOG.CREATE_ERROR_LOG(<span style="color: #aa5500">&#39;table&#39;</span>, <span style="color: #aa5500">&#39;error_table&#39;</span>);
</pre></div>

<p>Like SQL*Loader, you can specify a maximum number of errors to tolerate before failing and rolling back the transaction. You can also just say <code>UNLIMITED</code> if you don&rsquo;t ever want to fail the transaction.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>    LOG ERRORS <span style="color: #0000aa">INTO</span> error_table REJECT <span style="color: #0000aa">LIMIT</span> <span style="color: #009999">99</span>
    LOG ERRORS <span style="color: #0000aa">INTO</span> error_table REJECT <span style="color: #0000aa">LIMIT</span> UNLIMITED
</pre></div>

<p>Since the default limit is zero, it makes sense to always include this clause.</p>

<p>The last option is to specify a string that identifies that particular DML operation, so that you can group sets of errors in the log table. Here is an example that incorporates <code>SYSDATE</code> to tag all errors belonging to this DML operation.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>    LOG ERRORS <span style="color: #0000aa">INTO</span> error_table (<span style="color: #aa5500">&#39;Import from external datasource &#39;</span>||TO_CHAR(SYSDATE)) REJECT <span style="color: #0000aa">LIMIT</span> UNLIMITED
</pre></div>

<p>Putting it all together, here is a short example demonstrating the use of DML Error Logging for merging data between two similar, but non-identically structured tables. An alternate strategy might have involved creating a custom interface table with a block of PL/SQL to perform inserts and mark the failed rows. Here, we take advantage of the native capabilities of the database to simplify and accelerate the process.</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span></span>    <span style="color: #0000aa">create</span> <span style="color: #0000aa">table</span> users_loc (id <span style="color: #00aaaa">number</span> <span style="color: #0000aa">primary</span> <span style="color: #0000aa">key</span>, name varchar2(<span style="color: #009999">75</span>));
    
    <span style="color: #0000aa">create</span> <span style="color: #0000aa">table</span> users_ext (uuid varchar2(<span style="color: #009999">10</span>), fname varchar2(<span style="color: #009999">15</span>), lname varchar2(<span style="color: #009999">20</span>));
    <span style="color: #0000aa">insert</span> <span style="color: #0000aa">into</span> users_ext <span style="color: #0000aa">values</span>(<span style="color: #aa5500">&#39;1000&#39;</span>, <span style="color: #aa5500">&#39;Scotty&#39;</span>,  <span style="color: #aa5500">&#39;P&#39;</span>);
    <span style="color: #0000aa">insert</span> <span style="color: #0000aa">into</span> users_ext <span style="color: #0000aa">values</span>(<span style="color: #aa5500">&#39;2000&#39;</span>, <span style="color: #aa5500">&#39;Melinda&#39;</span>, <span style="color: #aa5500">&#39;Manning&#39;</span>);
    <span style="color: #0000aa">insert</span> <span style="color: #0000aa">into</span> users_ext <span style="color: #0000aa">values</span>(<span style="color: #aa5500">&#39;200J&#39;</span>, <span style="color: #aa5500">&#39;Jamie&#39;</span>,   <span style="color: #aa5500">&#39;Brooks&#39;</span>);
    <span style="color: #0000aa">insert</span> <span style="color: #0000aa">into</span> users_ext <span style="color: #0000aa">values</span>(<span style="color: #aa5500">&#39;1000&#39;</span>, <span style="color: #aa5500">&#39;Jason&#39;</span>,   <span style="color: #aa5500">&#39;Jennings&#39;</span>);
    <span style="color: #0000aa">insert</span> <span style="color: #0000aa">into</span> users_ext <span style="color: #0000aa">values</span>(<span style="color: #aa5500">&#39;4000&#39;</span>, <span style="color: #aa5500">&#39;Marcus&#39;</span>,  <span style="color: #aa5500">&#39;Nevada&#39;</span>);
    <span style="color: #0000aa">insert</span> <span style="color: #0000aa">into</span> users_ext <span style="color: #0000aa">values</span>(<span style="color: #aa5500">&#39;AAAA&#39;</span>, <span style="color: #aa5500">&#39;Alfred&#39;</span>,  <span style="color: #aa5500">&#39;Butler&#39;</span>);
    <span style="color: #0000aa">insert</span> <span style="color: #0000aa">into</span> users_ext <span style="color: #0000aa">values</span>(<span style="color: #aa5500">&#39;ABAB&#39;</span>, <span style="color: #aa5500">&#39;Simon&#39;</span>,   <span style="color: #aa5500">&#39;Jones&#39;</span>);
    <span style="color: #0000aa">insert</span> <span style="color: #0000aa">into</span> users_ext <span style="color: #0000aa">values</span>(<span style="color: #aa5500">&#39;6000&#39;</span>, <span style="color: #aa5500">&#39;Joon&#39;</span>,    <span style="color: #aa5500">&#39;Patel&#39;</span>);
    <span style="color: #0000aa">insert</span> <span style="color: #0000aa">into</span> users_ext <span style="color: #0000aa">values</span>(<span style="color: #aa5500">&#39;7000&#39;</span>, <span style="color: #aa5500">&#39;Wanda&#39;</span>,   <span style="color: #aa5500">&#39;Lutz&#39;</span>);
    <span style="color: #0000aa">insert</span> <span style="color: #0000aa">into</span> users_ext <span style="color: #0000aa">values</span>(<span style="color: #aa5500">&#39;8000&#39;</span>, <span style="color: #aa5500">&#39;Joseph&#39;</span>,  <span style="color: #aa5500">&#39;McBride&#39;</span>);
    
    <span style="color: #0000aa">exec</span> dbms_errlog.create_error_log(<span style="color: #aa5500">&#39;users_loc&#39;</span>,<span style="color: #aa5500">&#39;users_errs&#39;</span>);
    
    <span style="color: #0000aa">insert</span> <span style="color: #0000aa">into</span> users_loc (id, name) 
    <span style="color: #0000aa">select</span> uuid, 
           fname||<span style="color: #aa5500">&#39; &#39;</span>||lname 
      <span style="color: #0000aa">from</span> users_ext 
    log errors <span style="color: #0000aa">into</span> users_errs (<span style="color: #aa5500">&#39;import from users_ext: &#39;</span>||to_char(sysdate)) 
    reject <span style="color: #0000aa">limit</span> unlimited;
    
    col ora_err_mesg$ format a40
    col ora_err_rowid$ format a15
    col ora_err_tag$ format a50
    col id format a10
    col name format a30
    <span style="color: #0000aa">select</span> * <span style="color: #0000aa">from</span> users_errs;
    
    ORA_ERR_NUMBER$ ORA_ERR_MESG$                            ORA_ERR_ROWID$  ORA_ERR_OPTYP$ ORA_ERR_TAG$                                       ID         NAME                         
    <span style="color: #aaaaaa; font-style: italic">--------------- ---------------------------------------- --------------- -------------- -------------------------------------------------- ---------- ------------------------------</span>
               <span style="color: #009999">1722</span> ORA-<span style="color: #009999">01722</span>: invalid <span style="color: #00aaaa">number</span>                                I              import <span style="color: #0000aa">from</span> users_ext: <span style="color: #009999">07</span>-JUN-<span style="color: #009999">2012</span> <span style="color: #009999">12</span>:<span style="color: #009999">00</span>:<span style="color: #009999">09</span>        <span style="color: #009999">200</span>J       Jamie Brooks                   
                                                                                                                                                                                         
    
                  <span style="color: #009999">1</span> ORA-<span style="color: #009999">00001</span>: <span style="color: #0000aa">unique</span> <span style="color: #0000aa">constraint</span> (NUCDBA.SYS                 I              import <span style="color: #0000aa">from</span> users_ext: <span style="color: #009999">07</span>-JUN-<span style="color: #009999">2012</span> <span style="color: #009999">12</span>:<span style="color: #009999">00</span>:<span style="color: #009999">09</span>        <span style="color: #009999">1000</span>       Jason Jennings                 
                    _C00128181) violated                                                                                                                                                 
                                                                                                                                                                                         
    
               <span style="color: #009999">1722</span> ORA-<span style="color: #009999">01722</span>: invalid <span style="color: #00aaaa">number</span>                                I              import <span style="color: #0000aa">from</span> users_ext: <span style="color: #009999">07</span>-JUN-<span style="color: #009999">2012</span> <span style="color: #009999">12</span>:<span style="color: #009999">00</span>:<span style="color: #009999">09</span>        AAAA       Alfred Butler                  
                                                                                                                                                                                         
    
               <span style="color: #009999">1722</span> ORA-<span style="color: #009999">01722</span>: invalid <span style="color: #00aaaa">number</span>                                I              import <span style="color: #0000aa">from</span> users_ext: <span style="color: #009999">07</span>-JUN-<span style="color: #009999">2012</span> <span style="color: #009999">12</span>:<span style="color: #009999">00</span>:<span style="color: #009999">09</span>        ABAB       Simon Jones                    
</pre></div>

		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<hr>
		</div>
	</div>
</div>

    <div class="container">
        <div class="row col-md-12">
            <footer>
                <div class="pull-left">
                    <p>
                        &copy; 2015 ~ Toby Marks ~ Powered By <a href="http://hugo.spf13.com">Hugo</a> ~ <a href="http://www.tobybase.com//license/">License</a>
                    </p>
                </div>

                
                <div class="pull-right">
                    
                        <a href="https://www.linkedin.com/in/tobymarks" target="_blank">
                        <i class="fa fa-linkedin fa-2x"></i></a>
                    
                    
                    
                        <a href="https://twitter.com/toby_marks" target="_blank">
                        <i class="fa fa-twitter-square fa-2x"></i></a>
                    
                    
                        <a href="https://github.com/toby-marks" target="_blank">
                        <i class="fa fa-github-square fa-2x"></i></a>
                    
                    
                    
                    
                </div>
            </footer>
        </div>
    </div>

    
    <script src="http://www.tobybase.com//js/jquery.min-2.1.4.js"></script>
    <script src="http://www.tobybase.com//js/bootstrap.min-3.3.5.js"></script>

    
    </body>
</html>

